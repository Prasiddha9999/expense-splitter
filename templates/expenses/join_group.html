{% extends 'base.html' %}
{% load static %}

{% block title %}Join Group - Divider{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h2 class="text-center mb-0">Join a Group</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <p>Enter the 5-digit invitation code to join a group.</p>
                </div>
                
                <form method="POST" action="{% url 'group-join-code' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="inviteCode" class="form-label">Invitation Code</label>
                        <input type="text" class="form-control form-control-lg text-center" id="inviteCode" name="invite_code" 
                               placeholder="Enter 5-digit code" maxlength="5" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">Join Group</button>
                    </div>
                </form>
                
                <div class="text-center mt-4">
                    <p>Or scan a QR code to join a group</p>
                    <button type="button" class="btn btn-outline-primary" id="scanQrButton">
                        <i class="bi bi-qr-code-scan"></i> Scan QR Code
                    </button>
                    
                    <div id="qrScanner" class="mt-3" style="display: none;">
                        <div id="reader"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<script>
    document.getElementById('scanQrButton').addEventListener('click', function() {
        const qrScanner = document.getElementById('qrScanner');
        qrScanner.style.display = 'block';
        
        const html5QrCode = new Html5Qrcode("reader");
        const config = { fps: 10, qrbox: { width: 250, height: 250 } };
        
        html5QrCode.start({ facingMode: "environment" }, config, (decodedText) => {
            // Stop scanning
            html5QrCode.stop().then(() => {
                // Redirect to the join URL
                window.location.href = decodedText;
            });
        });
    });
</script>
{% endblock %}
